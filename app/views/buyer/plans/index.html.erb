<% if @bill %>
  <h1> Latest Available Bill for <%= current_user.email %></h1>
  <%= "Total: #{@bill.total}" %><br />
  <%= "Generated at: #{@bill.created_at}" %>
<% end %>

<% if @subscriptions.present? %>
  <h1> Currently Subscriped Plans: </h1>
  <ul class='list-group'>
    <% user_plans = get_plans(@subscriptions) %>
    <% user_plans.each do |plan| %>
      <% plan = find_plan(plan) %>
      <li class='list-group-item'>
        <strong class='text-primary'>Subscription Name: </strong> <%= plan.name %><br />
        <%= link_to 'Unsubscribe', buyer_subscription_path(plan), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-danger float-right'%>
        <strong>Monthly Fee: </strong><%= plan.monthly_fee %>
        <% plan.features.each do |feature| %>
          <li class='list-group-item'>
            <%= "Feature Name: #{feature.name}" %><br />
            <%= "Unit Price: #{feature.unit_price}" %>
            <% subscription = get_subscription(current_user.id, plan, feature.id) %>
            <%= link_to 'Consume Unit', increment_consumed_buyer_subscription_path(subscription), method: :patch, class:"btn btn-primary float-right mx-3" %>
            <div class="d-flex p-2 bd-highlight">
              <p class="text-primary">Allocated Units: </p><%= get_allocated_units(plan, feature.id) %>
              <p class="text-primary ms-3">Consumed Units: </p><%= subscription.consumed_units %>
            </div>
          </li>
        <% end  %>
      </li>
    <% end %>
  </ul>
<% end %>

<h1> Available Plans to Choose From : </h1>
<div class="row">
  <% @plans.each do |plan| %>
    <div class="col-sm-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title"><%= plan.name %> for $<%= plan.monthly_fee %></h5>
          <ul class="card-text">
            <% plan.features.each do |feature| %>
              <li><%= feature.name %></li>
            <% end %>
          </ul>
          <div><%= link_to 'Explore', buyer_plan_path(plan), class: 'btn btn-primary' %></div>
        </div>
      </div>
    </div>
  <% end %>
</div>
